"use strict";(globalThis.webpackChunkbpda=globalThis.webpackChunkbpda||[]).push([[5061],{5680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>g});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef(function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(l,".").concat(m)]||p[m]||u[m]||o;return n?a.createElement(g,s(s({ref:t},d),{},{components:n})):a.createElement(g,s({ref:t},d))});function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7900:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(8168),r=(n(6540),n(5680));const o={},s="Smart Contract deployment via Rust",i={unversionedId:"Practical Sessions/Smart Contracts/adder_rust_interaction",id:"Practical Sessions/Smart Contracts/adder_rust_interaction",title:"Smart Contract deployment via Rust",description:"Let's deploy our smart contract (SC) on the blockchain. We will deploy the adder contract from the previous section.",source:"@site/docs/Practical Sessions/Smart Contracts/adder_rust_interaction.md",sourceDirName:"Practical Sessions/Smart Contracts",slug:"/Practical Sessions/Smart Contracts/adder_rust_interaction",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Smart Contracts/adder_rust_interaction",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"The Adder SC",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Smart Contracts/adder"},next:{title:"Smart Contract deployment via Python (mxpy)",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Smart Contracts/mxpy_deploy"}},l={},c=[{value:"SC Deploy",id:"sc-deploy",level:2},{value:"SC Query",id:"sc-query",level:2},{value:"SC execute endpoint",id:"sc-execute-endpoint",level:2}],d={toc:c},p="wrapper";function u({components:e,...t}){return(0,r.yg)(p,(0,a.A)({},d,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"smart-contract-deployment-via-rust"},"Smart Contract deployment via Rust"),(0,r.yg)("p",null,"Let's deploy our smart contract (SC) on the blockchain. We will deploy the ",(0,r.yg)("inlineCode",{parentName:"p"},"adder")," contract from the previous section."),(0,r.yg)("p",null,"There is a folder named ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/multiversx/mx-contracts-rs/tree/main/contracts/adder/interactor"},"interactor"),"."),(0,r.yg)("p",null,"Let's take a look into the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/multiversx/mx-contracts-rs/blob/add-potlock-contract/contracts/adder/interact/src/basic_interact_cli.rs"},"basic_interactor_cli.rs")," file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},'#[derive(Clone, PartialEq, Eq, Debug, Subcommand)]\npub enum InteractCliCommand {\n    #[command(name = "deploy", about = "Deploy contract")]\n    Deploy,\n    #[command(name = "upgrade", about = "Upgrade contract")]\n    Upgrade(UpgradeArgs),\n    #[command(name = "sum", about = "Print sum")]\n    Sum,\n    #[command(name = "add", about = "Add value")]\n    Add(AddArgs),\n}\n')),(0,r.yg)("p",null,"We have 4 arguments we can use to interact with this contract. We will ",(0,r.yg)("inlineCode",{parentName:"p"},"deploy")," for now."),(0,r.yg)("p",null,"Let's take a look into the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/multiversx/mx-contracts-rs/blob/main/contracts/adder/interactor/src/basic_interactor.rs"},"basic_interactor.rs")," file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-Rust"},'pub async fn adder_cli() {\n    env_logger::init();\n\n    let config = Config::load_config();\n\n    let mut basic_interact = BasicInteractor::new(config).await;\n\n    let cli = basic_interactor_cli::InteractCli::parse();\n    match &cli.command {\n        Some(basic_interactor_cli::InteractCliCommand::Deploy) => {\n            basic_interact.deploy().await;\n        }\n        Some(basic_interactor_cli::InteractCliCommand::Upgrade(args)) => {\n            let owner_address = basic_interact.adder_owner_address.clone();\n            basic_interact\n                .upgrade(args.value, &owner_address, None)\n                .await\n        }\n        Some(basic_interactor_cli::InteractCliCommand::Add(args)) => {\n            basic_interact.add(args.value).await;\n        }\n        Some(basic_interactor_cli::InteractCliCommand::Sum) => {\n            let sum = basic_interact.get_sum().await;\n            println!("sum: {sum}");\n        }\n        None => {}\n    }\n}\n')),(0,r.yg)("h2",{id:"sc-deploy"},"SC Deploy"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"adder_cli")," function checks the arguments and calls the designated function."),(0,r.yg)("p",null,"We will be using ",(0,r.yg)("inlineCode",{parentName:"p"},"deploy")," async function to deploy our ",(0,r.yg)("inlineCode",{parentName:"p"},"adder")," smart contract:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},'pub async fn deploy(&mut self) {\n    let new_address = self\n        .interactor\n        .tx()\n        .from(&self.adder_owner_address.clone())\n        .gas(100_000_000)\n        .typed(adder_proxy::AdderProxy)\n        .init(0u64)\n        .code(ADDER_CODE_PATH)\n        .returns(ReturnsNewBech32Address)\n        .run()\n        .await;\n\n    println!("new address: {new_address}");\n    self.state.set_adder_address(new_address);\n}\n')),(0,r.yg)("p",null,"Let\u2019s break down the deploy command line by line. It follows a ",(0,r.yg)("a",{parentName:"p",href:"https://docs.multiversx.com/developers/transactions/tx-overview"},"unified syntax"),", meaning the same structure is used for ",(0,r.yg)("strong",{parentName:"p"},"contract development"),", ",(0,r.yg)("strong",{parentName:"p"},"interaction"),", and ",(0,r.yg)("strong",{parentName:"p"},"testing"),"."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".interactor.tx()")," - Initializes the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-env#interactor"},"environment")," where an empty transaction block is created."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".from(&self.adder_owner_address.clone())")," \u2013 Specifies the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-from#explicit-sender"},"sender")," of the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".gas(100_000_000)")," - Sets the amount of ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-gas"},"gas")," allocated for executing the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".typed(adder_proxy::AdderProxy).init(0u64)")," - Invokes the deploy function through a ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-proxies"},"proxy"),". The proxy is an object that mirrors the smart contract, exposing methods with the same names and arguments as those defined in the contract. The corresponding code is located in ",(0,r.yg)("inlineCode",{parentName:"li"},"/src/adder_proxy.rs")," (or can be found ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/multiversx/mx-contracts-rs/blob/main/contracts/adder/src/adder_proxy.rs"},"here"),")."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".code(ADDER_CODE_PATH)")," - Attaches the smart contract\u2019s bytecode to the deployment transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".returns(ReturnsNewBech32Address)")," - Defines the transaction\u2019s expected output. In this case, it returns the deployed ",(0,r.yg)("strong",{parentName:"li"},"contract\u2019s address"),". You can find all result handler types ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-result-handlers#list-of-result-decoders"},"here"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".run().await")," \u2013 Executes the transaction.")),(0,r.yg)("p",null,"The interactor will make a call to the blockchain from a wallet address. This is a test address and it's referenced from the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/multiversx/mx-sdk-rs/tree/master/sdk/core/src/test_wallets"},"MultiversX Framework SDK"),"."),(0,r.yg)("p",null,"Let's deploy a contract by running the following command in the ",(0,r.yg)("inlineCode",{parentName:"p"},"interactor")," directory:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cargo run deploy\n")),(0,r.yg)("p",null,"Below, it is the output of the command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.38s\n     Running `/home/adder/target/debug/basic-interactor deploy`\nwallet address: erd1uv40ahysflse896x4ktnh6ecx43u7cmy9wnxnvcyp7deg299a4sq6vaywa\nsender's recalled nonce: 5498\n-- tx nonce: 5498\nsc deploy tx hash: 4133385c40fee378f5fc1b6318f53302750c2403a9d02e00ed727c35ba9b41ba\ndeploy address: erd1qqqqqqqqqqqqqpgqef8xmsatt4tkf5ycv538a2kme3h7dy37a4sqygv9p5\n")),(0,r.yg)("p",null,"Notice the:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"sender's nonce - how many transactions he initiated;"),(0,r.yg)("li",{parentName:"ul"},"sc deploy tx hash - the hash of the transaction where we deployed the code on a new SC;"),(0,r.yg)("li",{parentName:"ul"},"deploy address - the address where the new SC is located.")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 1:")," Will this transaction show on the Explorer?"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 2:")," Will all the validators execute this transaction?"),(0,r.yg)("h2",{id:"sc-query"},"SC Query"),(0,r.yg)("p",null,"Let's read the storage from the SC:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},"pub async fn get_sum(&mut self) -> RustBigUint {\n    self.interactor\n        .query()\n        .to(self.state.current_adder_address())\n        .typed(adder_proxy::AdderProxy)\n        .sum()\n        .returns(ReturnsResultUnmanaged)\n        .run()\n        .await\n}\n")),(0,r.yg)("p",null,"Notice that we will make a ",(0,r.yg)("inlineCode",{parentName:"p"},"query")," on the blockchain to retrieve information. Let's break down the command line by line"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".interactor.query()")," - Initializes the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-env#interactor"},"environment")," where an empty query block is created. Smart contract queries, or view functions, are endpoints that only read data from the contract. It has ",(0,r.yg)("strong",{parentName:"li"},"no")," cost."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".to(self.state.current_adder_address())")," \u2013 Specifies the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-to/"},"receiver")," of the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".typed(adder_proxy::AdderProxy).sum()")," - Invokes the query function through a ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-proxies"},"proxy"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".returns(ReturnsResultUnmanaged)")," - Defines the transaction\u2019s expected output. It returns the unmanaged version of the original result , which in this case is ",(0,r.yg)("inlineCode",{parentName:"li"},"RustBigUint"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".run().await")," \u2013 Executes the transaction.")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 1:")," Will this transaction show on the Explorer?"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 2:")," Will all the validators execute this transaction?"),(0,r.yg)("p",null,"Remember from the ",(0,r.yg)("inlineCode",{parentName:"p"},"adder_cli")," function and the ",(0,r.yg)("inlineCode",{parentName:"p"},"basic_interactor_cli.rs")," file that we need to call ",(0,r.yg)("inlineCode",{parentName:"p"},"sum"),". Keep in mind that this command is only available in the ",(0,r.yg)("inlineCode",{parentName:"p"},"interactor")," directory:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cargo run sum\n")),(0,r.yg)("p",null,"The output of the command is shown below:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.09s\n     Running `/home/adder/target/debug/basic-interactor sum`\nsum: 0\n")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"sum")," storage is 0, because this was the value set in the deploy call by the interactor."),(0,r.yg)("h2",{id:"sc-execute-endpoint"},"SC execute endpoint"),(0,r.yg)("p",null,"Let's execute our first endpoint, the ",(0,r.yg)("inlineCode",{parentName:"p"},"add")," function:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},'pub async fn add(&mut self, value: u32) {\n    self.interactor\n        .tx()\n        .from(&self.wallet_address)\n        .to(self.state.current_adder_address())\n        .gas(6_000_000u64)\n        .typed(adder_proxy::AdderProxy)\n        .add(value)\n        .run()\n        .await;\n\n    println!("Successfully performed add");\n}\n')),(0,r.yg)("p",null,"Let's break down the command line by line:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".interactor.tx()")," - Initializes the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-env#interactor"},"environment")," where an empty transaction is created."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".from(&self.wallet_address)")," - The ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-from#explicit-sender"},"sender")," of the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".to(self.state.current_adder_address())")," \u2013 The ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-to/"},"receiver")," of the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".gas(6_000_000u64)")," - Sets the amount of ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-gas"},"gas")," allocated for executing the transaction."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".typed(adder_proxy::AdderProxy).add(value)")," - Invokes the endpoint method through a ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/transactions/tx-proxies"},"proxy"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},".run().await")," \u2013 Executes the transaction.")),(0,r.yg)("p",null,"Please inspect ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/multiversx/mx-contracts-rs/blob/add-potlock-contract/contracts/adder/interactor/src/basic_interactor.rs"},"basic_interactor.rs")," file one more time:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},"pub struct AddArgs {\n    /// The value to add\n    #[arg(short = 'v', long = \"value\")]\n    pub value: u32,\n}\n")),(0,r.yg)("p",null,"We must provide a parameter ",(0,r.yg)("inlineCode",{parentName:"p"},"-v $value")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"--value $value"),". Let's try it both ways:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cargo run add --value 2\n")),(0,r.yg)("p",null,"This is the output of the command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.13s\n     Running `/home/adder/target/debug/basic-interactor add --value 2`\nsender's recalled nonce: 5499\n-- tx nonce: 5499\nsc call tx hash: 2b85ad0af8bed72f415abcf03ed1615ab2e72c33354400f66aafd22346d1871c\nsuccessfully performed add\n")),(0,r.yg)("p",null,"Notice:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"tx nonce - this is the sender's nonce;"),(0,r.yg)("li",{parentName:"ul"},"sc call tx hash - this is the hash of the transaction we generated;")),(0,r.yg)("p",null,"We recommend checking every action you perform:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"}," $ cargo run sum\n    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.09s\n     Running `/home/adder/target/debug/basic-interactor sum`\nsum: 2\n")),(0,r.yg)("p",null,"Let's try the other way (",(0,r.yg)("inlineCode",{parentName:"p"},"-v $value"),"):"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"cargo run add -v 4\n")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.13s\n     Running `/home/adder/target/debug/basic-interactor add --value 4`\nsender's recalled nonce: 5500\n-- tx nonce: 5500\nsc call tx hash: a7f07975deb4ea01b19572146adb68b1b83abd1e7ed0396475cf389641ab03b5\nsuccessfully performed add\n\n")),(0,r.yg)("p",null,"Let's check that the storage was incremented:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"}," $ cargo run sum\n    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.27s\n     Running `/home/adder/target/debug/basic-interactor sum`\nsum: 6\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 1:")," Will these transactions (endpoint calling) show on the Explorer?"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Question 2:")," Will all the validators execute these transactions (endpoint calling)?"))}u.isMDXComponent=!0}}]);
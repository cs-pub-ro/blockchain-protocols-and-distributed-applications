"use strict";(globalThis.webpackChunkbpda=globalThis.webpackChunkbpda||[]).push([[5264],{5397(e,t,a){a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=a(8168),r=(a(6540),a(5680));const i={},s="Exposing and Querying Blockchain Data",o={unversionedId:"Practical Sessions/APIs/api",id:"Practical Sessions/APIs/api",title:"Exposing and Querying Blockchain Data",description:"While this lab utilizes the MultiversX network to demonstrate practical implementations, the fundamental principles of data exposure and querying\u2014such as the distinction between direct VM interaction and off-chain indexing\u2014are applicable across most blockchain architectures.",source:"@site/docs/Practical Sessions/APIs/api.md",sourceDirName:"Practical Sessions/APIs",slug:"/Practical Sessions/APIs/api",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/APIs/api",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"APIs",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/APIs/"},next:{title:"Scaling your APIs",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/APIs/scaling"}},l={},c=[{value:"Objectives",id:"objectives",level:2},{value:"1. Real-Time State (VM Queries) &amp; Observers",id:"1-real-time-state-vm-queries--observers",level:2},{value:"How it works: The Role of Observers",id:"how-it-works-the-role-of-observers",level:3},{value:"2. Data Indexing with ElasticSearch",id:"2-data-indexing-with-elasticsearch",level:2},{value:"Example: Retrieving Balance History",id:"example-retrieving-balance-history",level:3},{value:"Investigating Indices",id:"investigating-indices",level:3},{value:"3. The MultiversX API System",id:"3-the-multiversx-api-system",level:2},{value:"Architecture: Gateway vs. API",id:"architecture-gateway-vs-api",level:3},{value:"Practical Use Cases",id:"practical-use-cases",level:3},{value:"Use Case A: Filtering Transactions",id:"use-case-a-filtering-transactions",level:4},{value:"Use Case B: Getting Specific Account Data",id:"use-case-b-getting-specific-account-data",level:4}],p={toc:c};function u({components:e,...t}){return(0,r.yg)("wrapper",(0,n.A)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"exposing-and-querying-blockchain-data"},"Exposing and Querying Blockchain Data"),(0,r.yg)("p",null,"While this lab utilizes the MultiversX network to demonstrate practical implementations, the fundamental principles of data exposure and querying\u2014such as the distinction between direct VM interaction and off-chain indexing\u2014are applicable across most blockchain architectures."),(0,r.yg)("p",null,"This section outlines the specific architecture and methods used within the MultiversX ecosystem to fetch both real-time and historical data.."),(0,r.yg)("h2",{id:"objectives"},"Objectives"),(0,r.yg)("p",null,"By the end of this session, you will be able to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Understand how ",(0,r.yg)("strong",{parentName:"li"},"Observers")," facilitate ",(0,r.yg)("strong",{parentName:"li"},"VM Queries")," without participating in consensus."),(0,r.yg)("li",{parentName:"ul"},"Navigate the ",(0,r.yg)("strong",{parentName:"li"},"ElasticSearch")," indices to find specific data fields."),(0,r.yg)("li",{parentName:"ul"},"Differentiate between the ",(0,r.yg)("strong",{parentName:"li"},"Gateway (Proxy)")," and the ",(0,r.yg)("strong",{parentName:"li"},"API")," layer."),(0,r.yg)("li",{parentName:"ul"},"Use the API to perform advanced filtering on transactions and account data.")),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"1-real-time-state-vm-queries--observers"},"1. Real-Time State (VM Queries) & Observers"),(0,r.yg)("p",null,"As experimented with in the previous ",(0,r.yg)("strong",{parentName:"p"},"dApps")," labs, interacting with a Smart Contract doesn't always require a gas-consuming transaction."),(0,r.yg)("p",null,"To read the ",(0,r.yg)("strong",{parentName:"p"},"current state")," of a contract (e.g., a counter value, a storage variable), we use ",(0,r.yg)("strong",{parentName:"p"},"VM Queries"),"."),(0,r.yg)("h3",{id:"how-it-works-the-role-of-observers"},"How it works: The Role of Observers"),(0,r.yg)("p",null,"The MultiversX network consists of ",(0,r.yg)("strong",{parentName:"p"},"Validators")," and ",(0,r.yg)("strong",{parentName:"p"},"Observers"),"."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Validators")," are nodes that ",(0,r.yg)("strong",{parentName:"p"},"actively participate in consensus")," (they produce and validate blocks).")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"They are required to ",(0,r.yg)("strong",{parentName:"p"},"stake")," tokens (collateral) to ensure they secure the network and act honestly.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"They are responsible for processing transactions and appending new blocks to the blockchain (handling ",(0,r.yg)("strong",{parentName:"p"},'"Write"')," operations).")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Observers")," are nodes that ",(0,r.yg)("strong",{parentName:"p"},"do not participate in consensus")," (they don't produce blocks).")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"However, they execute every transaction to stay ",(0,r.yg)("strong",{parentName:"p"},"in sync")," with the network state.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Because they hold the full state of the blockchain locally, they offer an endpoint to execute ",(0,r.yg)("strong",{parentName:"p"},"Read-Only")," transactions."))),(0,r.yg)("p",null,"When you perform a VM Query (via SDK or dApp), you are asking an Observer to simulate the execution of a function locally. The Observer runs the code, retrieves the data from its local storage, and returns the result immediately."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"},"Note:"),' This action allows you to see the "live" state of the contract without broadcasting a transaction to the whole network.')),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"2-data-indexing-with-elasticsearch"},"2. Data Indexing with ElasticSearch"),(0,r.yg)("p",null,"While VM Queries are perfect for ",(0,r.yg)("em",{parentName:"p"},"current")," data, they cannot easily search through history. For this, MultiversX uses an off-chain indexing solution based on ",(0,r.yg)("strong",{parentName:"p"},"ElasticSearch"),"."),(0,r.yg)("p",null,"Nodes send data (blocks, transactions, logs) to an ElasticSearch cluster, where it is indexed for fast retrieval."),(0,r.yg)("h3",{id:"example-retrieving-balance-history"},"Example: Retrieving Balance History"),(0,r.yg)("p",null,"For example, if you want to search for the historical balance of an address, you have two options:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Use the ElasticSearch Index:")," You can query the ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/sdk-and-tools/indices/es-index-accountshistory"},(0,r.yg)("inlineCode",{parentName:"a"},"accountshistory"))," index directly."),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Use the Public API:")," Alternatively, you can use the API endpoint directly:\n",(0,r.yg)("inlineCode",{parentName:"li"},"https://api.multiversx.com/accounts/:address/history"))),(0,r.yg)("h3",{id:"investigating-indices"},"Investigating Indices"),(0,r.yg)("p",null,"To master data retrieval, you must ",(0,r.yg)("strong",{parentName:"p"},"go through the available indices")," in the documentation. This is crucial for obtaining detailed explanations about the data offered, understanding what each specific field represents, and learning how to formulate precise queries based on those fields."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"},"Reference:")," ",(0,r.yg)("a",{parentName:"p",href:"https://docs.multiversx.com/sdk-and-tools/elastic-search"},"MultiversX Docs: ElasticSearch"))),(0,r.yg)("h2",{id:"3-the-multiversx-api-system"},"3. The MultiversX API System"),(0,r.yg)("p",null,"When building an application, you rarely query ElasticSearch directly. Instead, you use the ",(0,r.yg)("strong",{parentName:"p"},"MultiversX API"),", which acts as an aggregation layer."),(0,r.yg)("h3",{id:"architecture-gateway-vs-api"},"Architecture: Gateway vs. API"),(0,r.yg)("p",null,"There are two distinct layers for accessing network data:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"The Gateway (Proxy):"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"This is a direct interface to the MultiversX Nodes."),(0,r.yg)("li",{parentName:"ul"},"It provides ",(0,r.yg)("strong",{parentName:"li"},"raw data")," (protocol level)."),(0,r.yg)("li",{parentName:"ul"},"It is used for broadcasting transactions and basic VM queries."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"The API (",(0,r.yg)("inlineCode",{parentName:"strong"},"api.multiversx.com"),"):"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"This layer sits ",(0,r.yg)("strong",{parentName:"li"},"on top")," of the Gateway and ElasticSearch."),(0,r.yg)("li",{parentName:"ul"},"It ",(0,r.yg)("strong",{parentName:"li"},"aggregates")," data from multiple sources."),(0,r.yg)("li",{parentName:"ul"},"It adds ",(0,r.yg)("strong",{parentName:"li"},"caching")," for performance."),(0,r.yg)("li",{parentName:"ul"},'It provides "human-friendly" data (e.g., decoding Smart Contract results).')))),(0,r.yg)("h3",{id:"practical-use-cases"},"Practical Use Cases"),(0,r.yg)("p",null,"You should primarily use the API for your dApps. Below are examples of how to retrieve specific data using the Devnet API."),(0,r.yg)("h4",{id:"use-case-a-filtering-transactions"},"Use Case A: Filtering Transactions"),(0,r.yg)("p",null,"If you want to find all transactions sent by a specific address, but exclude smart contract results (internal transactions), you can use API filters."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Request:"),"\n",(0,r.yg)("inlineCode",{parentName:"p"},"GET /transactions?sender=[ADDRESS]&withScResults=false&status=success")),(0,r.yg)("h4",{id:"use-case-b-getting-specific-account-data"},"Use Case B: Getting Specific Account Data"),(0,r.yg)("p",null,"To get details about an address, including its token balances (ESDTs) and nonce, without querying the raw node state."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Request:"),"\n",(0,r.yg)("inlineCode",{parentName:"p"},"GET /accounts/[ADDRESS]")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"The API automatically queries ElasticSearch for the history and the Gateway for the real-time balance, merging them into a single response.")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Reference:")," ",(0,r.yg)("a",{parentName:"p",href:"https://docs.multiversx.com/sdk-and-tools/rest-api/multiversx-api"},"MultiversX API Documentation")))}u.isMDXComponent=!0},5680(e,t,a){a.d(t,{xA:()=>p,yg:()=>y});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef(function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),g=c(a),y=r,d=g["".concat(l,".").concat(y)]||g[y]||u[y]||i;return a?n.createElement(d,s(s({ref:t},p),{},{components:a})):n.createElement(d,s({ref:t},p))});function y(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,s=new Array(i);s[0]=g;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"}}]);
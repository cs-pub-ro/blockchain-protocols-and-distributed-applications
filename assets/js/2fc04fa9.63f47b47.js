"use strict";(globalThis.webpackChunkbpda=globalThis.webpackChunkbpda||[]).push([[6566],{3533:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(8168),r=(n(6540),n(5680));const i={},o="Interactor and System Testing lab",s={unversionedId:"Practical Sessions/Smart Contracts/chain-sim",id:"Practical Sessions/Smart Contracts/chain-sim",title:"Interactor and System Testing lab",description:"This lab walks through building integration tests and running a local blockchain using the Interactor and Chain-Simulator. We will use the same subscription-sc smart contract from the previous lab.",source:"@site/docs/Practical Sessions/Smart Contracts/chain-sim.md",sourceDirName:"Practical Sessions/Smart Contracts",slug:"/Practical Sessions/Smart Contracts/chain-sim",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Smart Contracts/chain-sim",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Subscription Management SC",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Smart Contracts/subscription"},next:{title:"Learning Rust",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Learning Rust/"}},l={},c=[{value:"1. Clone the SC",id:"1-clone-the-sc",level:2},{value:"2. Chain-Simulator setup",id:"2-chain-simulator-setup",level:2},{value:"Understanding the interactor",id:"understanding-the-interactor",level:2},{value:"Deep dive into the interactor tests",id:"deep-dive-into-the-interactor-tests",level:2},{value:"Do it yourself",id:"do-it-yourself",level:2}],u={toc:c},h="wrapper";function m({components:e,...t}){return(0,r.yg)(h,(0,a.A)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"interactor-and-system-testing-lab"},"Interactor and System Testing lab"),(0,r.yg)("p",null,"This lab walks through building integration tests and running a local blockchain using the ",(0,r.yg)("inlineCode",{parentName:"p"},"Interactor")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Chain-Simulator"),". We will use the same ",(0,r.yg)("inlineCode",{parentName:"p"},"subscription-sc")," smart contract from the previous lab."),(0,r.yg)("p",null,"Key takeaways:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("inlineCode",{parentName:"li"},"interactor")," is a module that facilitates interaction with smart contracts in a simulated blockchain environment or directly on the live environments. You can find more info in the official ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/developers/meta/interactor/interactors-overview/"},"documentation"),"."),(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("inlineCode",{parentName:"li"},"chain-simulator")," mimics the behavior of a local testnet. It helps developers test smart contracts and dApps in a controlled environment. More details can be found in the official ",(0,r.yg)("a",{parentName:"li",href:"https://docs.multiversx.com/sdk-and-tools/chain-simulator/"},"documentation"))),(0,r.yg)("h1",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("h2",{id:"1-clone-the-sc"},"1. Clone the SC"),(0,r.yg)("p",null,"Clone and pull it in before you start:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/andreiblt1304/subscription-sc.git # HTTPS\ngit clone git@github.com:andreiblt1304/subscription-sc.git # SSH\n")),(0,r.yg)("p",null,"There have been some changes made to the original repository to accommodate this lab. The most important ones are:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Added ",(0,r.yg)("inlineCode",{parentName:"li"},"interactor")," folder that contains the interactor code."),(0,r.yg)("li",{parentName:"ul"},"Added the ",(0,r.yg)("inlineCode",{parentName:"li"},"sc-config.toml")," file that tells the sc-meta tool where to generate the proxy file.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'    [[proxy]]\n    path = "src/subscription_proxy.rs"\n')),(0,r.yg)("h2",{id:"2-chain-simulator-setup"},"2. Chain-Simulator setup"),(0,r.yg)("p",null,"If you are using the provided VM, the chain-simulator is already installed. If you are using your local machine all you have to do is have Docker installed and run the following command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# This will also install other dependencies but if you already have them installed it will skip them\nsc-meta all install\n")),(0,r.yg)("p",null,"To start the chain-simulator run the following command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"sc-meta cs-start\n")),(0,r.yg)("h2",{id:"understanding-the-interactor"},"Understanding the interactor"),(0,r.yg)("p",null,"The interactor has a straight forward structure:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"src")," - contains the main interactor code."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"tests")," - contains the integration tests that will be run against the chain-simulator.")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"The interactor uses ",(0,r.yg)("em",{parentName:"p"},"vanilla async rust"),", so make sure to familiarize yourself with it if you haven't already. Remember to use errors from the compiler as your friend! For further information regarding rust or async rust feel free to use any other source of your preference.")),(0,r.yg)("h2",{id:"deep-dive-into-the-interactor-tests"},"Deep dive into the interactor tests"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-rust"},'    #[tokio::test]\n    #[cfg_attr(not(feature = "chain-simulator-tests"), ignore)]\n    async fn test() {\n    // let mut interactor = ContractInteract::new(Config::new_config()).await;\n    let mut interactor = ContractInteract::new(Config::chain_simulator_config()).await;\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"#[tokio::test]")," - this macro allows us to write async tests using the tokio runtime."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},'#[cfg_attr(not(feature = "chain-simulator-tests"), ignore)]')," - this attribute ensures that the test is only run when the ",(0,r.yg)("inlineCode",{parentName:"li"},"chain-simulator-tests")," feature is enabled."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"async fn test() {}")," - the actual test function that will be executed."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"ContractInteract::new(Config::chain_simulator_config());")," - this line initializes a new instance of the interactor with the chain-simulator configuration."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"ContractInteract::new(Config::new_config());")," - this line initializes a new instance of the interactor with a custom configuration. Take a look at the ",(0,r.yg)("inlineCode",{parentName:"li"},"Config")," struct to see how to create your own configuration.")),(0,r.yg)("p",null,"To run the tests you have to run this command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"    sc-meta test -c\n    # OR\n    sc-meta test --chain-simulator-tests\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Remember to have the chain-simulator running in the background before running the tests.")),(0,r.yg)("h2",{id:"do-it-yourself"},"Do it yourself"),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Quick tip: the interactor uses the same syntax for writing tests, ",(0,r.yg)("em",{parentName:"p"},"the unified syntax"),". Since the last lab you worked on blackbox tests, this should be easy work. Here is the ",(0,r.yg)("a",{parentName:"p",href:"https://docs.multiversx.com/developers/testing/rust/sc-test-overview/#calling-contract-code"},"overview"),".")),(0,r.yg)("p",null,"The task for this lab is to add more tests to the interactor. Here are some ideas:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Create a test that deploys the contract and checks if the deployment was successful."),(0,r.yg)("li",{parentName:"ul"},"Create a test that tries to subscribe with insufficient funds and checks if the correct error is returned."),(0,r.yg)("li",{parentName:"ul"},"Create a test that checks if the subscription expiration date is correctly set after a successful subscription."),(0,r.yg)("li",{parentName:"ul"},"Create a test that checks if the unsubscribe functionality works as expected.")),(0,r.yg)("p",null,"Feel free to come up with your own ideas as well! The goal is to get comfortable with writing integration tests using the interactor and chain-simulator.\nFor easier attendance please also create a test that runs directly on the MultiversX devnet environment. After that send the transaction hash."))}m.isMDXComponent=!0},5680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>g});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef(function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),h=c(n),p=r,g=h["".concat(l,".").concat(p)]||h[p]||m[p]||i;return n?a.createElement(g,o(o({ref:t},u),{},{components:n})):a.createElement(g,o({ref:t},u))});function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);
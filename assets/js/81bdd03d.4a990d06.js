"use strict";(globalThis.webpackChunkbpda=globalThis.webpackChunkbpda||[]).push([[1549],{2480(e,t,a){a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(8168),r=(a(6540),a(5680));const i={},l="Practice: Caching & Scalability Demo",s={unversionedId:"Practical Sessions/APIs/practice",id:"Practical Sessions/APIs/practice",title:"Practice: Caching & Scalability Demo",description:"In this session, we will demonstrate how a single caching layer can protect your application from Rate Limits and allow it to scale to hundreds of concurrent users using NestJS and Redis.",source:"@site/docs/Practical Sessions/APIs/practice.md",sourceDirName:"Practical Sessions/APIs",slug:"/Practical Sessions/APIs/practice",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/APIs/practice",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Scaling your APIs",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/APIs/scaling"},next:{title:"Basic Peer-to-Peer Blockchain (Extra)",permalink:"/blockchain-protocols-and-distributed-applications/Practical Sessions/Basic Peer-to-Peer Blockchain (Extra)/"}},o={},p=[{value:"1. Environment Setup",id:"1-environment-setup",level:2},{value:"Step 1: Clone the Repository",id:"step-1-clone-the-repository",level:3},{value:"Step 2: Start Redis using Docker",id:"step-2-start-redis-using-docker",level:3},{value:"Step 3: Install Dependencies",id:"step-3-install-dependencies",level:3},{value:"Step 4: Configure Load Test Script",id:"step-4-configure-load-test-script",level:3},{value:"Step 5: Configure Environment",id:"step-5-configure-environment",level:3},{value:"2. Experiment A: Scalability (Caching ON)",id:"2-experiment-a-scalability-caching-on",level:2},{value:"What is happening?",id:"what-is-happening",level:3},{value:"What to observe:",id:"what-to-observe",level:3},{value:"3. Experiment B: The Bottleneck (Caching OFF)",id:"3-experiment-b-the-bottleneck-caching-off",level:2},{value:"What is happening?",id:"what-is-happening-1",level:3},{value:"What to observe:",id:"what-to-observe-1",level:3},{value:"4. Experiment C: Data Persistence (Warm Restart)",id:"4-experiment-c-data-persistence-warm-restart",level:2},{value:"What is happening?",id:"what-is-happening-2",level:3},{value:"What to observe:",id:"what-to-observe-2",level:3},{value:"Cleanup",id:"cleanup",level:2}],g={toc:p};function c({components:e,...t}){return(0,r.yg)("wrapper",(0,n.A)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"practice-caching--scalability-demo"},"Practice: Caching & Scalability Demo"),(0,r.yg)("p",null,"In this session, we will demonstrate how a single caching layer can protect your application from Rate Limits and allow it to scale to hundreds of concurrent users using ",(0,r.yg)("strong",{parentName:"p"},"NestJS")," and ",(0,r.yg)("strong",{parentName:"p"},"Redis"),"."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"}," Learning Objectives:")),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"See how ",(0,r.yg)("strong",{parentName:"li"},"Rate Limits")," block high-traffic apps."),(0,r.yg)("li",{parentName:"ol"},"Visualize how ",(0,r.yg)("strong",{parentName:"li"},"Caching")," reduces 100 network calls to just 1."),(0,r.yg)("li",{parentName:"ol"},"Demonstrate ",(0,r.yg)("strong",{parentName:"li"},"Data Persistence")," (Warm Start) where data survives application crashes.")),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"1-environment-setup"},"1. Environment Setup"),(0,r.yg)("h3",{id:"step-1-clone-the-repository"},"Step 1: Clone the Repository"),(0,r.yg)("p",null,"Clone the demo repository containing the NestJS application and the load testing script:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/stefangutica/mx-caching-demo.git\ncd mx-caching-demo\n")),(0,r.yg)("h3",{id:"step-2-start-redis-using-docker"},"Step 2: Start Redis using Docker"),(0,r.yg)("p",null,"We use Docker to spin up a local Redis instance."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker-compose up -d\n")),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"}," Why do we need Docker?"),'\nRedis is a database that runs on the operating system. Installing it manually on Windows/MacOS/Linux can be complicated.\nDocker allows us to run Redis in a lightweight "container" instantly, without installing it permanently on your laptop. It acts as our ',(0,r.yg)("strong",{parentName:"p"},"external shared memory"),".")),(0,r.yg)("h3",{id:"step-3-install-dependencies"},"Step 3: Install Dependencies"),(0,r.yg)("p",null,"Install the required Node.js packages for the server and the script:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"npm install\n")),(0,r.yg)("h3",{id:"step-4-configure-load-test-script"},"Step 4: Configure Load Test Script"),(0,r.yg)("p",null,"Open ",(0,r.yg)("inlineCode",{parentName:"p"},"load-test.js"),'. This script simulates users refreshing your dApp. We need to tweak the settings to be "aggressive".'),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"// Open load-test.js and ensure these values are set:\n\nconst CONCURRENT_REQUESTS = 100; \n// Most public APIs (like MultiversX API) allow ~5-10 requests per second. \n// We use 100 to GUARANTEE we hit the limit and crash the request, proving the need for caching.\n\nconst DELAY_BETWEEN_BATCHES_MS = 2000; \n// We chose 2 seconds as a suitable delay to give you enough time to read and analyze \n// the logs between batches before the screen scrolls too fast. Adapt it as you wish.\n")),(0,r.yg)("h3",{id:"step-5-configure-environment"},"Step 5: Configure Environment"),(0,r.yg)("p",null,"Create a ",(0,r.yg)("inlineCode",{parentName:"p"},".env")," file in the root of the project:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-env"},"# Initial Configuration: Caching is ENABLED\nCACHING_ENABLED=true\nREDIS_HOST=localhost\nREDIS_PORT=6379\n")),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"2-experiment-a-scalability-caching-on"},"2. Experiment A: Scalability (Caching ON)"),(0,r.yg)("p",null,"In this scenario, we simulate a healthy, scalable application."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Start the Server:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"npm run start\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Run Load Test (New Terminal):"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"node load-test.js\n")))),(0,r.yg)("h3",{id:"what-is-happening"},"What is happening?"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"The Data:")," Your server is asking the MultiversX API for the ",(0,r.yg)("strong",{parentName:"li"},"latest 25 transactions")," on the blockchain."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"The Traffic:")," 100 users are asking for this data at the exact same millisecond.")),(0,r.yg)("h3",{id:"what-to-observe"},"What to observe:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Load Test:")," ",(0,r.yg)("inlineCode",{parentName:"li"},"Successful Requests: 100"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"Failed Requests: 0"),"."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Server Logs:")," ",(0,r.yg)("inlineCode",{parentName:"li"},"CACHE MISS...")," appears ",(0,r.yg)("strong",{parentName:"li"},"ONLY ONCE"),".",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"Explanation:")," The first user triggered the request. The server saved the result in Redis. The subsequent 99 users received the data instantly from Redis (RAM), without touching the MultiversX API.")))),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"3-experiment-b-the-bottleneck-caching-off"},"3. Experiment B: The Bottleneck (Caching OFF)"),(0,r.yg)("p",null,"Now, let's see why caching is critical by turning it off."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Modify Configuration (.env):"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-env"},"CACHING_ENABLED=false\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Restart Server:")," Stop (",(0,r.yg)("inlineCode",{parentName:"li"},"Ctrl+C"),") and start again:",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"npm run start\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Run Load Test:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"node load-test.js\n")))),(0,r.yg)("h3",{id:"what-is-happening-1"},"What is happening?"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Now, every single user request forces your server to call the external API. "),(0,r.yg)("li",{parentName:"ul"},"Your server effectively becomes a tool for ",(0,r.yg)("strong",{parentName:"li"},"DDoS-ing")," the external API.")),(0,r.yg)("h3",{id:"what-to-observe-1"},"What to observe:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Server Logs:")," ",(0,r.yg)("inlineCode",{parentName:"li"},"CACHE MISS...")," appears ",(0,r.yg)("strong",{parentName:"li"},"100 times")," rapidly in a single batch."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Load Test:")," You will likely see ",(0,r.yg)("inlineCode",{parentName:"li"},"429 Too Many Requests")," errors.",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"Conclusion:")," The external API blocked you because you sent too many requests. Without caching, your app cannot scale beyond a few users.")))),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"4-experiment-c-data-persistence-warm-restart"},"4. Experiment C: Data Persistence (Warm Restart)"),(0,r.yg)("p",null,"One huge advantage of Redis (external cache) over local variable caching is that data survives server restarts."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Enable Caching (.env):"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-env"},"CACHING_ENABLED=true\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Increase TTL (src/app.service.ts):"),"\nOpen ",(0,r.yg)("inlineCode",{parentName:"li"},"src/app.service.ts")," and temporarily increase the Time-To-Live (TTL) so the cache doesn't expire while we restart the server.",(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"const ttlSeconds = 60; // Increase to 60s\n"))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Start Server & Populate Cache:"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"npm run start")),(0,r.yg)("li",{parentName:"ul"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"node load-test.js")," ",(0,r.yg)("strong",{parentName:"li"},"once")," (let one batch finish)."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"Check logs:")," You see ",(0,r.yg)("strong",{parentName:"li"},"1")," network fetch."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},'The "Crash" Simulation:'),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Stop the server")," (",(0,r.yg)("inlineCode",{parentName:"li"},"Ctrl + C"),") to simulate a crash or deployment."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Start the server")," immediately."))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("strong",{parentName:"li"},"Run Load Test Again:"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Run ",(0,r.yg)("inlineCode",{parentName:"li"},"node load-test.js"),".")))),(0,r.yg)("h3",{id:"what-is-happening-2"},"What is happening?"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Memory Wipe:")," When you stop the server (",(0,r.yg)("inlineCode",{parentName:"li"},"Ctrl+C"),"), the Node.js process dies, and any data stored in standard variables/RAM is lost."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"External Storage:")," Redis is running in a separate container (Docker). It stays alive even if your app crashes. When your app restarts, it reconnects to Redis, finds the data still there, and serves it instantly.")),(0,r.yg)("h3",{id:"what-to-observe-2"},"What to observe:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("strong",{parentName:"li"},"Server Logs:")," ",(0,r.yg)("strong",{parentName:"li"},"ZERO")," network requests logged."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("em",{parentName:"li"},"Explanation:"),' Even though the Node.js process died, the data remained safe in Docker (Redis). When the server restarted ("Warm Start"), it found the data and served it instantly.')),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"cleanup"},"Cleanup"),(0,r.yg)("p",null,"Stop the Redis container to free up resources:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker-compose down\n")))}c.isMDXComponent=!0},5680(e,t,a){a.d(t,{xA:()=>g,yg:()=>y});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},g=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef(function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,g=s(e,["components","mdxType","originalType","parentName"]),u=p(a),y=r,m=u["".concat(o,".").concat(y)]||u[y]||c[y]||i;return a?n.createElement(m,l(l({ref:t},g),{},{components:a})):n.createElement(m,l({ref:t},g))});function y(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);